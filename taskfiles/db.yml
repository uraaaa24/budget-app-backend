version: '3'

tasks:
  prepare:
    desc: アプリ内の定義から、マイグレーションファイルを作成する
    cmds:
      - uv run alembic revision --autogenerate -m "auto migration"
  migrate:
    desc: Run database migrations
    cmds:
      - uv run alembic upgrade head

  connect:
    desc: Connect to database (uses .env DATABASE_URL)
    cmds:
      - |
        DB_URL=$(grep "^DATABASE_URL=" .env | cut -d'=' -f2 | sed 's/postgresql+psycopg:/postgresql:/')
        psql "$DB_URL"
